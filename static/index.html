<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>EZFW CALCULATOR</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #e6f0fa;
            margin: 0;
            padding: 0;
            text-transform: uppercase;
        }

        h1 {
            text-align: center;
            margin-top: 20px;
            color: #1a2b4c;
            display: inline-block;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 900px;
            margin: 20px auto 0 auto;
            padding: 0 10px;
        }

        .button-group {
            display: flex;
            gap: 10px;
        }

        button {
            padding: 10px 20px;
            background-color: #1a2b4c;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            text-transform: uppercase;
        }

        button:hover {
            background-color: #2d4a7c;
        }

        .container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, max-content));
            gap: 20px;
            max-width: 900px;
            margin: 20px auto;
            padding: 20px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        label {
            display: block;
            font-weight: bold;
            margin-bottom: 5px;
            color: #1a2b4c;
            white-space: nowrap;
        }

        input,
        select,
        textarea {
            width: 100%;
            max-width: 180px;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 6px;
            margin-bottom: 10px;
            font-size: 14px;
            box-sizing: border-box;
        }

        textarea {
            resize: vertical;
        }

        .wide-field {
            grid-column: span 2;
            display: grid;
            grid-template-columns: auto auto;
            gap: 20px;
        }

        .bottom-fields {
            grid-column: span 2;
            display: grid;
            grid-template-columns: 200px 1fr;
            gap: 20px;
            align-items: start;
        }

        .results-container {
            max-width: 900px;
            margin: 10px auto;
            padding: 10px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 14px;
            text-transform: uppercase;
        }

        th,
        td {
            padding: 10px;
            border: 1px solid #ccc;
            text-align: center;
        }

        th {
            background-color: #1a2b4c;
            color: #ffffff;
        }

        tr:nth-child(even) {
            background-color: #f2f6fc;
        }
    </style>
</head>

<body>

    <div class="top-bar">
        <h1>EZFW CALCULATOR</h1>
        <div class="button-group">
            <button onclick="window.print()">PRINT</button>
            <button onclick="saveData()">SAVE</button>
        </div>
    </div>

    <div class="container">
        <!-- Aircraft Selection -->
        <div>
            <label for="aircraftSelect">SELECT AIRCRAFT</label>
            <select id="aircraftSelect">
                <option value="">--Select--</option>
            </select>
        </div>

        <!-- Flight Info -->
        <div>
            <label for="flightNumber">FLIGHT NUMBER</label>
            <input type="text" id="flightNumber" style="text-transform:uppercase;">
        </div>
        <div>
            <label for="origin">ORIGIN</label>
            <input type="text" id="origin" style="text-transform:uppercase;">
        </div>
        <div>
            <label for="destination">DESTINATION</label>
            <input type="text" id="destination" style="text-transform:uppercase;">
        </div>
        <div>
            <label for="std">STD (UTC)</label>
            <input type="text" id="std">
        </div>

        <!-- Aircraft Type -->
        <div>
            <label for="aircraftType">AIRCRAFT TYPE</label>
            <select id="aircraftType">
                <option value="Narrow">Narrow</option>
                <option value="Wide">Wide</option>
            </select>
            <input type="text" id="aircraftTypeText" style="display:none;" readonly>
        </div>

        <!-- Weights -->
        <div>
            <label for="dow">DOW</label>
            <input type="number" id="dow" step="0.01" value="0" readonly>
        </div>
        <div>
            <label for="totalPax">TOTAL PAX</label>
            <input type="number" id="totalPax" step="1" value="">
        </div>
        <div>
            <label for="avgPaxWeight">AVG PAX WEIGHT</label>
            <input type="number" id="avgPaxWeight" step="0.01" value="0">
        </div>
        <div>
            <label for="avgBags">AVG BAGS PER PAX</label>
            <input type="number" id="avgBags" step="0.01" value="0">
        </div>
        <div>
            <label for="avgBagsWeight">AVG BAG WEIGHT</label>
            <input type="number" id="avgBagsWeight" step="0.01" value="0">
        </div>
        <div>
            <label for="cargoWeight">CARGO WEIGHT</label>
            <input type="number" id="cargoWeight" step="0.01" value="0">
        </div>
        <div>
            <label for="serviceWeight">SERVICE WEIGHT</label>
            <input type="number" id="serviceWeight" step="0.01" value="0">
        </div>

        <!-- Wide Body Fields -->
        <div class="wide-field" id="wideBodyFields" style="display:none;">
            <div>
                <label for="avgULDWeight">AVG ULD TARE WEIGHT</label>
                <input type="number" id="avgULDWeight" step="0.01" value="0">
            </div>
            <div>
                <label for="bagsPerULD">AVG BAGS PER ULD</label>
                <input type="number" id="bagsPerULD" step="0.01" value="0">
            </div>
        </div>

        <!-- Compiled By & Notes row -->
        <div style="grid-column: 1 / -1; display: grid; grid-template-columns: 200px 1fr; gap: 20px; margin-top: 10px;">
            <div>
                <label for="compiledBy">COMPILED BY</label>
                <input type="text" id="compiledBy" style="text-transform:uppercase; width:100%;">
            </div>
            <div style="width: 100%;">
                <label for="notes">NOTES</label>
                <textarea id="notes"
                    style="width:100%; max-width: none; height:100px; resize: none; box-sizing: border-box;"></textarea>
            </div>
        </div>
    </div>

    <!-- RESULTS TABLE -->
    <div class="results-container">
        <table>
            <tr>
                <th>FLIGHT</th>
                <th>TOTAL PAX</th>
                <th>TOTAL PAX WEIGHT</th>
                <th>TOTAL BAGS</th>
                <th>TOTAL BAG WEIGHT</th>
                <th>CARGO WEIGHT</th>
                <th>SERVICE WEIGHT</th>
                <th>TOTAL ULDS</th>
                <th>TOTAL ULD TARE</th>
                <th>EZFW</th>
                <th>EZFW ROUNDED</th>
            </tr>
            <tr>
                <td id="flightDetails"></td>
                <td id="totalPaxDisplay">0</td>
                <td id="totalPaxWeight">0</td>
                <td id="totalBags">0</td>
                <td id="totalBagWeight">0</td>
                <td id="cargoWeightDisplay">0</td>
                <td id="serviceWeightDisplay">0</td>
                <td id="totalULDs">0</td>
                <td id="totalULDTare">0</td>
                <td id="ezfw">0</td>
                <td id="zfw">0</td>
            </tr>
        </table>
    </div>

    <script>
        // Load aircraft data from CSV
        const aircraftData = [];
        fetch('aircraft.csv')
            .then(response => response.text())
            .then(text => {
                const lines = text.trim().split('\n').slice(1);
                lines.forEach(line => {
                    const [registration, dow, type] = line.split(',');
                    aircraftData.push({ registration, dow: parseFloat(dow), type });
                });
                populateAircraftSelect();
            });

        const aircraftSelect = document.getElementById("aircraftSelect");
        const aircraftType = document.getElementById("aircraftType");
        const aircraftTypeText = document.getElementById("aircraftTypeText");
        const dowInput = document.getElementById("dow");
        const wideFields = document.getElementById("wideBodyFields");

        function updateInputListeners() {
            const inputs = document.querySelectorAll("input:not([readonly]), select:not([disabled]), textarea");
            inputs.forEach(input => {
                input.removeEventListener("input", calculate);
                input.addEventListener("input", calculate);
            });
        }

        function populateAircraftSelect() {
            aircraftData.forEach(ac => {
                const option = document.createElement("option");
                option.value = ac.registration;
                option.text = ac.registration;
                aircraftSelect.appendChild(option);
            });
        }

        // When aircraft is selected
        aircraftSelect.addEventListener("change", () => {
            const selected = aircraftData.find(ac => ac.registration === aircraftSelect.value);
            if (selected) {
                dowInput.value = selected.dow;
                aircraftType.style.display = "none";
                aircraftTypeText.style.display = "block";
                aircraftTypeText.value = selected.type;
                wideFields.style.display = (selected.type === "Wide") ? "grid" : "none";
                calculate();
                updateInputListeners();
            } else {
                aircraftType.style.display = "block";
                aircraftTypeText.style.display = "none";
                dowInput.value = 0;
                updateInputListeners();
            }
        });

        aircraftType.addEventListener("change", () => {
            wideFields.style.display = (aircraftType.value === "Wide") ? "grid" : "none";
            calculate();
            updateInputListeners();
        });

        function calculate() {
            const flightNumber = document.getElementById("flightNumber").value;
            const origin = document.getElementById("origin").value;
            const destination = document.getElementById("destination").value;
            const std = document.getElementById("std").value;

            document.getElementById("flightDetails").innerText =
                `${flightNumber} (${origin}→${destination}) STD: ${std}`;

            let dow = parseFloat(dowInput.value) || 0;
            let totalPax = parseFloat(document.getElementById("totalPax").value) || 0;
            let avgPaxWeight = parseFloat(document.getElementById("avgPaxWeight").value) || 0;
            let avgBags = parseFloat(document.getElementById("avgBags").value) || 0;
            let avgBagsWeight = parseFloat(document.getElementById("avgBagsWeight").value) || 0;
            let cargoWeight = parseFloat(document.getElementById("cargoWeight").value) || 0;
            let serviceWeight = parseFloat(document.getElementById("serviceWeight").value) || 0;

            let totalPaxWeight = Math.ceil(totalPax * avgPaxWeight);
            let totalBags = Math.ceil(totalPax * avgBags);
            let totalBagWeight = Math.ceil(totalBags * avgBagsWeight);

            let totalULDs = 0, totalULDTare = 0;
            const currentType = aircraftTypeText.style.display === "block" ? aircraftTypeText.value : aircraftType.value;
            if (currentType === "Wide") {
                let avgULDWeight = parseFloat(document.getElementById("avgULDWeight").value) || 0;
                let bagsPerULD = parseFloat(document.getElementById("bagsPerULD").value) || 1;
                totalULDs = Math.ceil(totalBags / bagsPerULD);
                totalULDTare = totalULDs * avgULDWeight;
            }

            let ezfw = dow + totalPaxWeight + totalBagWeight + cargoWeight + serviceWeight + totalULDTare;
            let zfw = Math.ceil(ezfw / 100) * 100;

            document.getElementById("totalPaxDisplay").innerText = totalPax;
            document.getElementById("totalPaxWeight").innerText = totalPaxWeight;
            document.getElementById("totalBags").innerText = totalBags;
            document.getElementById("totalBagWeight").innerText = totalBagWeight;
            document.getElementById("cargoWeightDisplay").innerText = cargoWeight;
            document.getElementById("serviceWeightDisplay").innerText = serviceWeight;
            document.getElementById("totalULDs").innerText = totalULDs;
            document.getElementById("totalULDTare").innerText = totalULDTare;
            document.getElementById("ezfw").innerText = ezfw.toFixed(2);
            document.getElementById("zfw").innerText = zfw;
        }

        updateInputListeners();
        window.onload = () => {
            updateInputListeners();
            setTimeout(calculate, 100);
        };

        function saveData() {
            const data = {
                aircraft: aircraftSelect.value,
                flightNumber: document.getElementById("flightNumber").value,
                origin: document.getElementById("origin").value,
                destination: document.getElementById("destination").value,
                std: document.getElementById("std").value,
                dow: dowInput.value,
                totalPax: document.getElementById("totalPax").value,
                avgPaxWeight: document.getElementById("avgPaxWeight").value,
                avgBags: document.getElementById("avgBags").value,
                avgBagsWeight: document.getElementById("avgBagsWeight").value,
                cargoWeight: document.getElementById("cargoWeight").value,
                serviceWeight: document.getElementById("serviceWeight").value,
                avgULDWeight: document.getElementById("avgULDWeight").value,
                bagsPerULD: document.getElementById("bagsPerULD").value,
                compiledBy: document.getElementById("compiledBy").value,
                notes: document.getElementById("notes").value
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `EZFW_${data.flightNumber || 'data'}_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }
    </script>

</body>

</html>